import{o as T,c as l,b as m,w as y,a as t,d as w,t as s,u as r,l as C,h as D,F as _,r as $,p as v,j as G,k as z,m as h,f as n,q as b}from"./app-CCP2hVtR.js";import{s as j}from"./index-CznJ1WnQ.js";const A={class:"max-w-4xl mx-auto px-4 py-8 sm:py-12"},R={key:0,class:"space-y-6"},q={key:1,class:"text-center py-16"},E={class:"text-lg text-slate-500 dark:text-slate-400 mb-4"},I={class:"flex items-center justify-between mb-6"},M={class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-200"},N={class:"font-mono text-emerald-600 dark:text-emerald-400"},O={class:"text-sm text-slate-500 dark:text-slate-400 mt-1"},H={class:"p-6 rounded-2xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 mb-8"},J={class:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-200"},K={class:"space-y-3"},P={class:"flex items-center gap-3"},Q={class:"font-bold text-emerald-600 dark:text-emerald-400"},U={class:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-200"},W={class:"space-y-3"},X=["onClick"],Y={class:"flex items-center gap-3"},Z={class:"text-sm font-bold text-slate-400"},ee={class:"font-mono font-bold text-emerald-600 dark:text-emerald-400 tracking-widest"},te={key:0,class:"border-t border-slate-200 dark:border-slate-800"},se={class:"text-slate-800 dark:text-slate-200 break-words"},ae={class:"flex items-center gap-2 mt-1"},re={class:"text-xs text-slate-400"},oe={key:0,class:"text-xs text-slate-400"},le={key:0,class:"p-4 text-sm text-slate-400 text-center"},ie={__name:"ArchiveGame",props:{code:String},setup(V){const p=V,{t:i}=z(),c=h(null),f=h(!0),x=h(""),u=h([]);function F(a){return a?new Date(a).toLocaleDateString():""}async function B(){f.value=!0,x.value="";try{const{data:a}=await G.archive.get(p.code);c.value={...a.game||{},standings:a.players||[],rounds:(a.rounds||[]).map(d=>({...d,answers:d.answers?d.answers.map(e=>({...e,player_nickname:e.player_name,voted_by:e.voters||[]})):void 0}))},c.value.rounds?.length&&(u.value=c.value.rounds.map(d=>d.round_number))}catch(a){a.response?.status===404?x.value=i("common.notFound"):x.value=a.response?.data?.message||i("common.error")}finally{f.value=!1}}async function L(a){const d=u.value.indexOf(a);if(d>=0){u.value.splice(d,1);return}u.value.push(a);const e=c.value?.rounds?.find(o=>o.round_number===a);if(e&&!e.answers)try{const{data:o}=await G.archive.round(p.code,a),k=o.answers??o.data??[];e.answers=k.map(g=>({...g,player_nickname:g.player_name,voted_by:g.voters||[]}))}catch{e.answers=[]}}async function S(){const a=`${window.location.origin}/arkiv/${p.code}`;try{await navigator.clipboard.writeText(a)}catch{}}return T(B),(a,d)=>(n(),l("div",A,[m(r(C),{href:"/arkiv",class:"inline-flex items-center gap-1 text-sm text-emerald-600 dark:text-emerald-400 hover:underline mb-6"},{default:y(()=>[d[0]||(d[0]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)),w(" "+s(r(i)("archive.backToArchive")),1)]),_:1}),f.value?(n(),l("div",R,[m(r(j),{width:"200px",height:"2rem"}),m(r(j),{height:"8rem"}),m(r(j),{height:"12rem"})])):x.value?(n(),l("div",q,[t("p",E,s(x.value),1),m(r(D),{label:r(i)("common.retry"),severity:"secondary",onClick:B},null,8,["label"])])):c.value?(n(),l(_,{key:2},[t("div",I,[t("div",null,[t("h1",M,[t("span",N,"#"+s(c.value.code),1)]),t("p",O,s(F(c.value.finished_at)),1)]),m(r(D),{label:r(i)("archive.shareGame"),severity:"secondary",variant:"outlined",size:"small",onClick:S},null,8,["label"])]),t("div",H,[t("h2",J,s(r(i)("archive.finalStandings")),1),t("div",K,[(n(!0),l(_,null,$(c.value.standings,(e,o)=>(n(),l("div",{key:e.player_id,class:b(["flex items-center justify-between p-3 rounded-xl",e.is_winner?"bg-emerald-50 dark:bg-emerald-950/50 border border-emerald-200 dark:border-emerald-900":"border border-slate-200 dark:border-slate-800"])},[t("div",P,[t("span",{class:b(["text-lg font-bold w-8 text-center",e.is_winner?"text-emerald-600 dark:text-emerald-400":"text-slate-400"])},s(o+1),3),m(r(C),{href:`/profil/${e.nickname}`,class:"font-medium text-slate-800 dark:text-slate-200 hover:text-emerald-600 dark:hover:text-emerald-400"},{default:y(()=>[w(s(e.nickname),1)]),_:2},1032,["href"])]),t("span",Q,s(e.score)+" "+s(r(i)("game.points")),1)],2))),128))])]),t("h2",U,s(r(i)("games.rounds")),1),t("div",W,[(n(!0),l(_,null,$(c.value.rounds,e=>(n(),l("div",{key:e.round_number,class:"rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden"},[t("button",{onClick:o=>L(e.round_number),class:"w-full flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-left"},[t("div",Y,[t("span",Z,s(r(i)("game.round"))+" "+s(e.round_number),1),t("span",ee,s(e.acronym),1)]),(n(),l("svg",{class:b([{"rotate-180":u.value.includes(e.round_number)},"w-5 h-5 text-slate-400 transition-transform"]),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...d[1]||(d[1]=[t("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,X),u.value.includes(e.round_number)?(n(),l("div",te,[(n(!0),l(_,null,$(e.answers,(o,k)=>(n(),l("div",{key:o.id,class:b(["p-4 border-b last:border-b-0 border-slate-100 dark:border-slate-800",k===0?"bg-emerald-50/50 dark:bg-emerald-950/30":""])},[t("p",se,s(o.text?.toLowerCase()),1),t("div",ae,[m(r(C),{href:`/profil/${o.player_nickname}`,class:"text-sm text-emerald-600 dark:text-emerald-400 hover:underline"},{default:y(()=>[w(s(o.player_nickname),1)]),_:2},1032,["href"]),t("span",re,s(o.votes_count)+" "+s(r(i)("game.votes")),1),o.voted_by?.length?(n(),l("span",oe," ("+s(o.voted_by.join(", "))+") ",1)):v("",!0)])],2))),128)),e.answers?.length?v("",!0):(n(),l("div",le,s(r(i)("common.loading")),1))])):v("",!0)]))),128))])],64)):v("",!0)]))}};export{ie as default};
