import{v as L,z as G,c as n,a as e,t as s,u as t,F as N,r as M,p as u,y as U,b as c,s as p,h as S,d as A,w as W,l as $,k as F,m as k,n as I,f as i,x as C}from"./app-CCP2hVtR.js";import{s as R}from"./index-B5S8LY6B.js";import"./index-CdoIoPxA.js";const q={class:"max-w-md mx-auto px-4 py-12 sm:py-20"},z={key:0,class:"mb-6 p-4 rounded-2xl bg-emerald-50 dark:bg-emerald-950/50 border border-emerald-200 dark:border-emerald-900 text-center"},D={class:"text-sm font-medium text-emerald-700 dark:text-emerald-300 mb-1"},J={class:"text-xl font-mono font-bold tracking-[0.3em] text-emerald-600 dark:text-emerald-400"},T={class:"text-sm text-emerald-600 dark:text-emerald-400 mt-1"},H={class:"flex flex-wrap justify-center gap-1.5 mt-2"},K={class:"text-center text-sm text-slate-500 dark:text-slate-400 mb-4"},Q={class:"p-6 rounded-2xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 mb-6"},X={class:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-200"},Y={key:0,class:"p-3 rounded-lg bg-red-50 dark:bg-red-950/50 border border-red-200 dark:border-red-900 text-sm text-red-700 dark:text-red-300"},Z={class:"flex flex-col gap-2"},ee={for:"guestNickname",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},te={class:"flex items-center gap-4 mb-6"},se={class:"text-sm text-slate-400 dark:text-slate-500"},ae={class:"text-3xl font-bold text-center mb-8 text-slate-800 dark:text-slate-200"},le={key:2,class:"p-3 rounded-lg bg-emerald-50 dark:bg-emerald-950/50 border border-emerald-200 dark:border-emerald-900 text-sm text-emerald-700 dark:text-emerald-300 mb-6"},re={key:0,class:"p-3 rounded-lg bg-red-50 dark:bg-red-950/50 border border-red-200 dark:border-red-900 text-sm text-red-700 dark:text-red-300"},de={class:"flex flex-col gap-2"},oe={for:"name",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},ne={key:0,class:"text-red-500"},ie={class:"flex flex-col gap-2"},me={for:"email",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},ue={key:0,class:"text-red-500"},ce={class:"flex flex-col gap-2"},xe={for:"nickname",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},ge={key:0,class:"text-red-500"},fe={class:"flex flex-col gap-2"},be={for:"password",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},pe={key:0,class:"text-red-500"},ke={class:"flex flex-col gap-2"},ve={for:"password_confirmation",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},he={class:"flex items-center gap-4 my-8"},_e={class:"text-sm text-slate-400 dark:text-slate-500"},we={class:"p-6 rounded-2xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},ye={class:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-200"},Ve={key:0,class:"p-3 rounded-lg bg-red-50 dark:bg-red-950/50 border border-red-200 dark:border-red-900 text-sm text-red-700 dark:text-red-300"},Pe={class:"flex flex-col gap-2"},Ne={for:"guestNickname2",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},Ue={class:"mt-6 text-center text-sm text-slate-500 dark:text-slate-400"},Ae={__name:"Register",props:{gamePreview:{type:Object,default:null}},setup(g){const x=L(),{t:l}=F(),_=x.isAuthenticated&&x.isGuest,m=G({name:"",email:"",nickname:x.nickname||"",password:"",password_confirmation:""}),w=k(!1),v=k(""),o=G({}),f=k(""),h=k(!1),b=k("");function E(){return new URLSearchParams(window.location.search).get("redirect")||""}function y(){const d=E()||"/spill";return d.startsWith("/")&&!d.startsWith("//")&&!d.includes("://")?d:"/spill"}const O=I(()=>{const d=y();return d&&d!=="/spill"?`/logg-inn?redirect=${encodeURIComponent(d)}`:"/logg-inn"});async function B(){w.value=!0,v.value="",Object.keys(o).forEach(d=>delete o[d]);try{x.isAuthenticated&&x.isGuest?await x.convertGuest({...m}):await x.register({...m}),C.visit(y())}catch(d){const a=d.response?.status,r=d.response?.data;a===422&&r?.errors?Object.assign(o,Object.fromEntries(Object.entries(r.errors).map(([V,P])=>[V,Array.isArray(P)?P[0]:P]))):v.value=r?.message||l("common.error")}finally{w.value=!1}}async function j(){if(f.value.trim()){h.value=!0,b.value="";try{await x.createGuest(f.value.trim()),C.visit(y())}catch(d){b.value=d.response?.data?.message||l("common.error")}finally{h.value=!1}}}return(d,a)=>(i(),n("div",q,[g.gamePreview?(i(),n("div",z,[e("p",D,s(t(l)("auth.joiningGame")),1),e("p",J," #"+s(g.gamePreview.code),1),e("p",T,s(t(l)("auth.gameWithPlayers").replace("{count}",g.gamePreview.player_count)),1),e("div",H,[(i(!0),n(N,null,M(g.gamePreview.players,(r,V)=>(i(),n("span",{key:V,class:"text-xs px-2 py-0.5 rounded-full bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300"},s(r),1))),128))])])):u("",!0),g.gamePreview&&!t(_)?(i(),n(N,{key:1},[e("p",K,s(t(l)("auth.quickJoin")),1),e("div",Q,[e("h2",X,s(t(l)("auth.guest.title")),1),e("form",{onSubmit:U(j,["prevent"]),class:"space-y-4"},[b.value?(i(),n("div",Y,s(b.value),1)):u("",!0),e("div",Z,[e("label",ee,s(t(l)("auth.guest.nickname")),1),c(t(p),{id:"guestNickname",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=r=>f.value=r),class:"w-full"},null,8,["modelValue"])]),c(t(S),{type:"submit",label:t(l)("auth.guest.submit"),severity:"success",loading:h.value,class:"w-full"},null,8,["label","loading"])],32)]),e("div",te,[a[7]||(a[7]=e("div",{class:"flex-1 h-px bg-slate-200 dark:bg-slate-800"},null,-1)),e("span",se,s(t(l)("auth.or")),1),a[8]||(a[8]=e("div",{class:"flex-1 h-px bg-slate-200 dark:bg-slate-800"},null,-1))])],64)):u("",!0),e("h1",ae,s(t(l)("auth.register.title")),1),t(_)?(i(),n("div",le,s(t(l)("auth.register.convertNotice")),1)):u("",!0),e("form",{onSubmit:U(B,["prevent"]),class:"space-y-5"},[v.value?(i(),n("div",re,s(v.value),1)):u("",!0),e("div",de,[e("label",oe,s(t(l)("auth.register.name")),1),c(t(p),{id:"name",modelValue:m.name,"onUpdate:modelValue":a[1]||(a[1]=r=>m.name=r),autocomplete:"name",invalid:!!o.name,class:"w-full"},null,8,["modelValue","invalid"]),o.name?(i(),n("small",ne,s(o.name),1)):u("",!0)]),e("div",ie,[e("label",me,s(t(l)("auth.register.email")),1),c(t(p),{id:"email",modelValue:m.email,"onUpdate:modelValue":a[2]||(a[2]=r=>m.email=r),type:"email",autocomplete:"email",invalid:!!o.email,class:"w-full"},null,8,["modelValue","invalid"]),o.email?(i(),n("small",ue,s(o.email),1)):u("",!0)]),e("div",ce,[e("label",xe,s(t(l)("auth.register.nickname")),1),c(t(p),{id:"nickname",modelValue:m.nickname,"onUpdate:modelValue":a[3]||(a[3]=r=>m.nickname=r),autocomplete:"username",invalid:!!o.nickname,class:"w-full"},null,8,["modelValue","invalid"]),o.nickname?(i(),n("small",ge,s(o.nickname),1)):u("",!0)]),e("div",fe,[e("label",be,s(t(l)("auth.register.password")),1),c(t(R),{id:"password",modelValue:m.password,"onUpdate:modelValue":a[4]||(a[4]=r=>m.password=r),toggleMask:"",invalid:!!o.password,inputClass:"w-full",class:"w-full"},null,8,["modelValue","invalid"]),o.password?(i(),n("small",pe,s(o.password),1)):u("",!0)]),e("div",ke,[e("label",ve,s(t(l)("auth.register.confirmPassword")),1),c(t(R),{id:"password_confirmation",modelValue:m.password_confirmation,"onUpdate:modelValue":a[5]||(a[5]=r=>m.password_confirmation=r),feedback:!1,toggleMask:"",inputClass:"w-full",class:"w-full"},null,8,["modelValue"])]),c(t(S),{type:"submit",label:t(l)("auth.register.submit"),severity:"success",loading:w.value,class:"w-full"},null,8,["label","loading"])],32),!g.gamePreview&&!t(_)?(i(),n(N,{key:3},[e("div",he,[a[9]||(a[9]=e("div",{class:"flex-1 h-px bg-slate-200 dark:bg-slate-800"},null,-1)),e("span",_e,s(t(l)("auth.or")),1),a[10]||(a[10]=e("div",{class:"flex-1 h-px bg-slate-200 dark:bg-slate-800"},null,-1))]),e("div",we,[e("h2",ye,s(t(l)("auth.guest.title")),1),e("form",{onSubmit:U(j,["prevent"]),class:"space-y-4"},[b.value?(i(),n("div",Ve,s(b.value),1)):u("",!0),e("div",Pe,[e("label",Ne,s(t(l)("auth.guest.nickname")),1),c(t(p),{id:"guestNickname2",modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=r=>f.value=r),class:"w-full"},null,8,["modelValue"])]),c(t(S),{type:"submit",label:t(l)("auth.guest.submit"),severity:"secondary",loading:h.value,class:"w-full"},null,8,["label","loading"])],32)])],64)):u("",!0),e("p",Ue,[A(s(t(l)("auth.register.hasAccount"))+" ",1),c(t($),{href:O.value,class:"text-emerald-600 dark:text-emerald-400 font-medium hover:underline"},{default:W(()=>[A(s(t(l)("auth.register.login")),1)]),_:1},8,["href"])])]))}};export{Ae as default};
