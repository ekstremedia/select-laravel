import{v as te,U as se,V as ae,X as le,o as re,Z as oe,g as C,w as M,a as t,f as r,c as n,b as m,u as e,t as a,h as b,F as f,q as F,p as g,e as I,x as k,r as p,i as ne,y as ie,s as de,m as x,k as ce,n as h,j as ue}from"./app-CCP2hVtR.js";import{s as N,_ as me,u as xe}from"./useGameAnimations-BVktlYM7.js";import{u as ve}from"./gameStore-C6TK5yyB.js";const fe={class:"flex flex-col h-full overflow-hidden"},be={key:0,class:"flex-1 flex items-center justify-center"},pe={key:1,class:"flex-1 flex flex-col items-center justify-center px-4"},_e={class:"text-lg text-slate-500 dark:text-slate-400 mb-4"},ye={key:0,class:"shrink-0 px-4 py-2 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800"},ge={class:"flex items-center justify-between mb-1"},ke={class:"text-xs text-slate-500 dark:text-slate-400"},he={key:1,class:"shrink-0 px-4 py-3 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950"},we={class:"max-w-lg mx-auto flex items-center justify-between gap-3"},Ce={class:"flex items-center gap-2"},Re={class:"text-sm text-slate-500 dark:text-slate-400"},je={key:0,class:"block text-center text-red-500 mt-2"},Ge={key:2,class:"flex-1 overflow-y-auto"},Se={class:"max-w-md mx-auto px-4 py-8 text-center"},$e={class:"text-2xl font-bold mb-6 text-slate-800 dark:text-slate-200"},Ve={class:"text-sm text-slate-500 dark:text-slate-400 mb-6"},Le={class:"space-y-2"},Ae={class:"flex items-center gap-2"},Fe={class:"w-8 h-8 rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center text-sm font-bold text-emerald-600 dark:text-emerald-400"},Ie={class:"font-medium text-slate-800 dark:text-slate-200"},ze={key:3,class:"flex-1 overflow-y-auto"},Be={class:"text-slate-500 dark:text-slate-400"},Ue={key:4,class:"flex-1 overflow-y-auto"},Pe={class:"text-xl font-bold text-center mb-6 text-slate-800 dark:text-slate-200"},qe={class:"flex justify-center gap-2 mb-6"},De={class:"space-y-3"},Ee={class:"text-slate-800 dark:text-slate-200"},Je={class:"text-center text-sm text-slate-400 mt-4"},Me={key:5,class:"flex-1 overflow-y-auto"},Ne={class:"text-xl font-bold text-center mb-6 text-slate-800 dark:text-slate-200"},Te={class:"space-y-3 mb-8"},We={class:"flex items-start justify-between gap-3"},He={class:"font-medium text-slate-800 dark:text-slate-200"},Oe={class:"text-sm text-slate-500 dark:text-slate-400 mt-1"},Xe={class:"p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},Ze={class:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3"},Ke={class:"space-y-2"},Qe={class:"text-sm text-slate-700 dark:text-slate-300"},Ye={class:"text-sm font-bold text-emerald-600 dark:text-emerald-400"},et={key:6,class:"flex-1 overflow-y-auto"},tt={class:"max-w-lg mx-auto px-4 py-8 text-center"},st={class:"text-3xl font-bold mb-2 text-emerald-600 dark:text-emerald-400"},at={key:0,class:"my-6 p-6 rounded-2xl bg-emerald-50 dark:bg-emerald-950/50 border border-emerald-200 dark:border-emerald-900"},lt={class:"text-sm text-emerald-600 dark:text-emerald-400 mb-1"},rt={class:"text-2xl font-bold text-emerald-700 dark:text-emerald-300"},ot={class:"p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 mb-6"},nt={class:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3"},it={class:"space-y-2"},dt={class:"flex items-center gap-2"},ct={class:"text-sm font-bold text-slate-400 w-5"},ut={class:"text-sm font-medium text-slate-700 dark:text-slate-300"},mt={class:"text-sm font-bold text-emerald-600 dark:text-emerald-400"},xt={class:"text-sm text-slate-500 dark:text-slate-400 mb-4"},vt={class:"flex justify-end gap-2"},_t=Object.assign({layout:!1},{__name:"GameSpectate",props:{code:String},setup(T){const u=T,s=ve(),_=te(),{t:o}=ce(),{animatePhaseIn:V,staggerLetters:W,staggerCards:z,staggerRows:B}=xe(),{phase:d}=se(s),L=x(!0),R=x(""),j=x(!1),w=x(""),y=x(!1),G=x(""),U=x(null),P=x(null),A=x(null),S=x(null),H=h(()=>s.currentGame?.settings?.rounds??5),q=h(()=>s.acronym?s.acronym.split(""):[]),O=h(()=>d.value==="playing"||d.value==="voting"),X=h(()=>{if(!s.deadline)return 100;const c=d.value==="voting"?s.currentGame?.settings?.vote_time??30:s.currentGame?.settings?.answer_time??60;return Math.max(0,s.timeRemaining/c*100)}),Z=h(()=>{const c=s.currentGame?.settings?.max_players??8;return s.players.length>=c}),K=h(()=>d.value&&d.value!=="finished");async function Q(){if(w.value="",s.currentGame?.has_password){G.value="",y.value=!0;return}await D()}async function Y(){await D(G.value)}async function D(c){j.value=!0,w.value="";try{await ue.games.join(u.code,c),y.value=!1,k.visit(`/spill/${u.code}`)}catch(i){const l=i.response?.data?.error||i.response?.data?.message||"";if(l.toLowerCase().includes("already in game")){y.value=!1,k.visit(`/spill/${u.code}`);return}w.value=l||o("common.error")}finally{j.value=!1}}async function E(){L.value=!0,R.value="";let c=!1;try{if(_.isInitialized||await _.loadFromStorage(),await s.fetchGame(u.code),_.player&&s.players.some(i=>i.id===_.player.id)){c=!0,k.visit(`/spill/${u.code}`);return}_.isAuthenticated?s.connectWebSocket(u.code):ee(),(d.value==="playing"||d.value==="voting")&&await s.fetchCurrentRound(u.code)}catch(i){R.value=i.response?.data?.message||o("common.error")}finally{c||(L.value=!1)}}let $=null;function ee(){J(),$=setInterval(async()=>{try{await s.fetchGame(u.code),(d.value==="playing"||d.value==="voting")&&await s.fetchCurrentRound(u.code)}catch{}},5e3)}function J(){$&&(clearInterval($),$=null)}return ae(d,(c,i)=>{i&&le(()=>{if(c==="playing")V(U.value),W(P.value);else if(c==="voting")V(A.value),z(A.value,".vote-card",.15);else if(c==="results"){V(S.value);const l=z(S.value,".result-card",.1);B(S.value,".score-row",l+.1)}else c==="finished"&&B(document.querySelector(".final-score-row")?.parentElement,".final-score-row",.4)})}),re(E),oe(()=>{s.disconnectWebSocket(),J()}),(c,i)=>(r(),C(me,{"game-code":e(s).gameCode||u.code,"player-count":e(s).players.length,"is-private":e(s).currentGame?.has_password===!0,"leave-label":e(o)("common.back"),onLeave:i[5]||(i[5]=l=>e(k).visit("/spill"))},{default:M(()=>[t("div",fe,[L.value?(r(),n("div",be,[m(e(N),{mode:"indeterminate",class:"w-48"})])):R.value?(r(),n("div",pe,[t("p",_e,a(R.value),1),m(e(b),{label:e(o)("common.retry"),severity:"secondary",onClick:E},null,8,["label"])])):(r(),n(f,{key:2},[O.value?(r(),n("div",ye,[t("div",ge,[t("span",ke,a(e(o)("game.round"))+" "+a(e(s).currentRound?.round_number??1)+" "+a(e(o)("game.of"))+" "+a(H.value),1),t("span",{class:F(["text-sm font-mono font-bold",e(s).timeRemaining<=10?"text-red-500":"text-slate-700 dark:text-slate-300"])},a(e(s).timeRemaining)+"s ",3)]),m(e(N),{value:X.value,showValue:!1,style:{height:"4px"}},null,8,["value"])])):g("",!0),K.value?(r(),n("div",he,[t("div",we,[t("div",Ce,[m(e(I),{value:e(o)("spectate.watching"),severity:"info"},null,8,["value"]),t("span",Re,a(e(s).players.length)+"/"+a(e(s).currentGame?.settings?.max_players??8)+" "+a(e(o)("common.players")),1)]),e(_).isAuthenticated?Z.value?(r(),C(e(b),{key:1,label:e(o)("spectate.gameFull"),severity:"secondary",size:"small",disabled:""},null,8,["label"])):(r(),C(e(b),{key:2,label:e(o)("spectate.join"),severity:"success",size:"small",loading:j.value,onClick:Q},null,8,["label","loading"])):(r(),C(e(b),{key:0,label:e(o)("nav.login"),severity:"success",size:"small",onClick:i[0]||(i[0]=l=>e(k).visit(`/logg-inn?redirect=/spill/${u.code}/se`))},null,8,["label"]))]),w.value?(r(),n("small",je,a(w.value),1)):g("",!0)])):g("",!0),e(d)==="lobby"?(r(),n("div",Ge,[t("div",Se,[t("h2",$e,a(e(o)("lobby.title")),1),t("p",Ve,a(e(o)("lobby.waitingForHost")),1),t("div",Le,[(r(!0),n(f,null,p(e(s).players,l=>(r(),n("div",{key:l.id,class:"flex items-center justify-between p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},[t("div",Ae,[t("div",Fe,a(l.nickname?.charAt(0)?.toUpperCase()),1),t("span",Ie,a(l.nickname),1)]),l.id===e(s).currentGame?.host_player_id?(r(),C(e(I),{key:0,value:e(o)("lobby.host"),severity:"success"},null,8,["value"])):g("",!0)]))),128))])])])):e(d)==="playing"?(r(),n("div",ze,[t("div",{ref_key:"playingContainerRef",ref:U,class:"max-w-lg mx-auto px-4 py-6 text-center"},[t("div",{ref_key:"acronymContainerRef",ref:P,class:"flex justify-center gap-2 sm:gap-3 mb-6"},[(r(!0),n(f,null,p(q.value,(l,v)=>(r(),n("span",{key:v,class:"acronym-letter inline-flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16 rounded-xl text-xl sm:text-3xl font-bold bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300 border-2 border-emerald-300 dark:border-emerald-700"},a(l),1))),128))],512),t("p",Be,a(e(s).currentRound?.answers_count??0)+"/"+a(e(s).currentRound?.total_players??e(s).players.length)+" "+a(e(o)("game.submitted")),1)],512)])):e(d)==="voting"?(r(),n("div",Ue,[t("div",{ref_key:"votingContainerRef",ref:A,class:"max-w-lg mx-auto px-4 py-6"},[t("h2",Pe,a(e(o)("game.voting")),1),t("div",qe,[(r(!0),n(f,null,p(q.value,(l,v)=>(r(),n("span",{key:v,class:"inline-flex items-center justify-center w-8 h-8 rounded text-sm font-bold bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300"},a(l),1))),128))]),t("div",De,[(r(!0),n(f,null,p(e(s).answers,l=>(r(),n("div",{key:l.id,class:"vote-card p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},[t("p",Ee,a(l.text?.toLowerCase()),1)]))),128))]),t("p",Je,a(e(s).currentRound?.votes_count??0)+"/"+a(e(s).currentRound?.total_voters??0)+" "+a(e(o)("game.votes")),1)],512)])):e(d)==="results"?(r(),n("div",Me,[t("div",{ref_key:"resultsContainerRef",ref:S,class:"max-w-lg mx-auto px-4 py-6"},[t("h2",Ne,a(e(o)("game.results")),1),t("div",Te,[(r(!0),n(f,null,p(e(s).roundResults,(l,v)=>(r(),n("div",{key:l.answer_id||v,class:F(["result-card p-4 rounded-xl border border-slate-200 dark:border-slate-800",v===0?"bg-emerald-50 dark:bg-emerald-950/50 border-emerald-200 dark:border-emerald-900":"bg-slate-50 dark:bg-slate-900"])},[t("div",We,[t("div",null,[t("p",He,a(l.text?.toLowerCase()),1),t("p",Oe,a(l.player_nickname),1)]),m(e(I),{value:l.votes_count,severity:"success"},null,8,["value"])])],2))),128))]),t("div",Xe,[t("h3",Ze,a(e(o)("game.scoreboard")),1),t("div",Ke,[(r(!0),n(f,null,p(e(s).scores,l=>(r(),n("div",{key:l.player_id,class:"score-row flex items-center justify-between"},[t("span",Qe,a(l.nickname),1),t("span",Ye,a(l.score),1)]))),128))])])],512)])):e(d)==="finished"?(r(),n("div",et,[t("div",tt,[t("h2",st,a(e(o)("game.finished")),1),e(s).currentGame?.winner?(r(),n("div",at,[t("p",lt,a(e(o)("game.winner")),1),t("p",rt,a(e(s).currentGame.winner.nickname),1)])):g("",!0),t("div",ot,[t("h3",nt,a(e(o)("game.finalScores")),1),t("div",it,[(r(!0),n(f,null,p(e(s).scores,(l,v)=>(r(),n("div",{key:l.player_id,class:F(["final-score-row flex items-center justify-between p-2 rounded",v===0?"bg-emerald-50 dark:bg-emerald-950/50":""])},[t("div",dt,[t("span",ct,a(v+1)+".",1),t("span",ut,a(l.nickname),1)]),t("span",mt,a(l.score),1)],2))),128))])]),m(e(b),{label:e(o)("game.viewArchive"),severity:"secondary",variant:"outlined",onClick:i[1]||(i[1]=l=>e(k).visit(`/arkiv/${u.code}`))},null,8,["label"])])])):g("",!0)],64))]),m(e(ne),{visible:y.value,"onUpdate:visible":i[4]||(i[4]=l=>y.value=l),header:e(o)("lobby.passwordRequired"),modal:"",class:"w-80"},{default:M(()=>[t("p",xt,a(e(o)("lobby.enterPassword")),1),t("form",{onSubmit:ie(Y,["prevent"])},[m(e(de),{modelValue:G.value,"onUpdate:modelValue":i[2]||(i[2]=l=>G.value=l),type:"password",class:"w-full mb-4",autofocus:""},null,8,["modelValue"]),t("div",vt,[m(e(b),{label:e(o)("common.cancel"),severity:"secondary",variant:"text",onClick:i[3]||(i[3]=l=>y.value=!1)},null,8,["label"]),m(e(b),{label:e(o)("games.join"),severity:"success",type:"submit",loading:j.value},null,8,["label","loading"])])],32)]),_:1},8,["visible","header"])]),_:1},8,["game-code","player-count","is-private","leave-label"]))}});export{_t as default};
