import{o as M,Z as O,c as i,a as t,q as k,t as l,b as m,u as b,h,s as W,d as F,p as S,F as E,r as N,n as p,ad as j,b0 as $,ae as D,m as g,b1 as U,b2 as q,f as c}from"./app-CCP2hVtR.js";const R={class:"max-w-2xl mx-auto px-4 py-8"},H={class:"flex items-center gap-3"},K={class:"font-semibold"},Y={class:"text-sm opacity-75"},Z={class:"mb-6 p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},Q={class:"grid grid-cols-2 gap-2 text-sm"},X={class:"font-mono text-slate-800 dark:text-slate-200"},ee={class:"font-mono text-slate-800 dark:text-slate-200"},te={class:"font-mono text-slate-800 dark:text-slate-200"},se={class:"font-mono text-slate-800 dark:text-slate-200"},ae={class:"font-mono text-slate-800 dark:text-slate-200"},ne={class:"font-mono text-slate-800 dark:text-slate-200"},le={class:"flex flex-wrap gap-2 mb-6"},oe={class:"mb-6 p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},re={class:"flex gap-2 mb-3"},de={key:0,class:"text-sm text-emerald-600 dark:text-emerald-400"},ie={class:"font-mono"},ce={key:1,class:"mt-2"},ue={class:"text-xs text-slate-500 mb-1"},ve={class:"flex flex-wrap gap-1"},me={class:"p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800"},be={class:"text-sm font-semibold mb-3 text-slate-600 dark:text-slate-400 uppercase tracking-wide"},pe={key:0,class:"text-sm text-slate-400 dark:text-slate-500 italic"},ge={key:1,class:"space-y-1 max-h-96 overflow-y-auto font-mono text-xs"},xe={class:"text-slate-400 shrink-0"},he={__name:"WebSocketTest",setup(fe){const J=U(),v=g([]),o=g("disconnected"),x=g(""),d=g(null),u=g([]);let f=null,_=null;const r=p(()=>{const n=J.props?.reverb;return{host:window.location.hostname,port:n?.port||document.querySelector('meta[name="reverb-port"]')?.content||"?",key:n?.key||document.querySelector('meta[name="reverb-key"]')?.content||"",tls:window.location.protocol==="https:",hasAuth:!!localStorage.getItem("select-auth-token"),hasGuest:!!localStorage.getItem("select-guest-token")}}),G=p(()=>{switch(o.value){case"connected":return"Connected";case"connecting":return"Connecting...";case"unavailable":return"Unavailable";case"failed":return"Failed";case"disconnected":return"Disconnected";default:return o.value}}),L=p(()=>{switch(o.value){case"connected":return"WebSocket connection is active";case"connecting":return"Attempting to connect to Reverb server...";case"unavailable":return"Server unreachable. Check Apache proxy and Reverb container.";case"failed":return"Connection failed. Check browser console for details.";case"disconnected":return"Click Connect to test the WebSocket connection";default:return""}}),T=p(()=>{switch(o.value){case"connected":return"bg-emerald-50 dark:bg-emerald-950/30 border-emerald-200 dark:border-emerald-900 text-emerald-800 dark:text-emerald-200";case"connecting":return"bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-900 text-amber-800 dark:text-amber-200";case"unavailable":case"failed":return"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-900 text-red-800 dark:text-red-200";default:return"bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400"}}),V=p(()=>{switch(o.value){case"connected":return"bg-emerald-500 animate-pulse";case"connecting":return"bg-amber-500 animate-pulse";case"unavailable":case"failed":return"bg-red-500";default:return"bg-slate-400"}});function s(n,e="info"){const w=new Date().toLocaleTimeString("en-GB",{hour12:!1});v.value.unshift({time:w,message:n,type:e}),v.value.length>200&&v.value.pop()}function z(){s("Connecting to Reverb...","info");try{const n=$();s(`Initial state: ${n}`,"info"),I(),D("__test__"),j("__test__"),setTimeout(()=>{const e=$();o.value=e,e==="connected"?s("Connected successfully!","success"):s(`State after init: ${e}`,"info")},2e3)}catch(n){s(`Connection error: ${n.message}`,"error")}}function A(){y(),q(),o.value="disconnected",C(),s("Disconnected","info")}function B(){const n=x.value.trim().toUpperCase();if(n){s(`Joining presence-game.${n}...`,"info");try{_=D(n),d.value=n,_.here(e=>{u.value=e,s(`Channel joined! ${e.length} member(s) present: ${e.map(a=>a.nickname||a.id).join(", ")}`,"success")}).joining(e=>{u.value.push(e),s(`Member joined: ${e.nickname||e.id}`,"event")}).leaving(e=>{u.value=u.value.filter(a=>a.id!==e.id),s(`Member left: ${e.nickname||e.id}`,"event")}).listen(".player.joined",e=>{s(`Event: player.joined — ${JSON.stringify(e)}`,"event")}).listen(".player.left",e=>{s(`Event: player.left — ${JSON.stringify(e)}`,"event")}).listen(".game.started",e=>{s(`Event: game.started — ${JSON.stringify(e)}`,"event")}).listen(".round.started",e=>{s(`Event: round.started — acronym: ${e.acronym}`,"event")}).listen(".answer.submitted",e=>{s(`Event: answer.submitted — ${e.answers_count}/${e.total_players}`,"event")}).listen(".voting.started",e=>{s(`Event: voting.started — ${e.answers?.length} answers`,"event")}).listen(".vote.submitted",e=>{s(`Event: vote.submitted — ${e.votes_count}/${e.total_voters}`,"event")}).listen(".round.completed",e=>{s(`Event: round.completed — ${JSON.stringify(e.scores)}`,"event")}).listen(".game.finished",e=>{s(`Event: game.finished — winner: ${e.winner?.nickname}`,"event")}).listen(".chat.message",e=>{s(`Event: chat.message — ${e.nickname}: ${e.message}`,"event")}).error(e=>{s(`Channel error: ${JSON.stringify(e)}`,"error")})}catch(e){s(`Join error: ${e.message}`,"error")}}}function y(){d.value&&(j(d.value),s(`Left channel presence-game.${d.value}`,"info"),d.value=null,u.value=[],_=null)}function P(){y()}function I(){C(),f=setInterval(()=>{const n=$();if(n!==o.value){const e=o.value;o.value=n,s(`Connection state: ${e} → ${n}`,n==="connected"?"success":n==="unavailable"||n==="failed"?"error":"info")}},1e3)}function C(){f&&(clearInterval(f),f=null)}return M(()=>{s("WebSocket test page loaded","info"),s(`Config: ${r.value.tls?"wss":"ws"}://${r.value.host}:${r.value.port}`,"info")}),O(()=>{y(),C()}),(n,e)=>(c(),i("div",R,[e[12]||(e[12]=t("h1",{class:"text-2xl font-bold mb-6 text-slate-800 dark:text-slate-200"}," WebSocket Test ",-1)),t("div",{class:k(["mb-6 p-4 rounded-xl border",T.value])},[t("div",H,[t("div",{class:k(["w-3 h-3 rounded-full",V.value])},null,2),t("div",null,[t("p",K,l(G.value),1),t("p",Y,l(L.value),1)])])],2),t("div",Z,[e[9]||(e[9]=t("h2",{class:"text-sm font-semibold mb-3 text-slate-600 dark:text-slate-400 uppercase tracking-wide"},"Configuration",-1)),t("div",Q,[e[3]||(e[3]=t("span",{class:"text-slate-500"},"Host:",-1)),t("span",X,l(r.value.host),1),e[4]||(e[4]=t("span",{class:"text-slate-500"},"Port:",-1)),t("span",ee,l(r.value.port),1),e[5]||(e[5]=t("span",{class:"text-slate-500"},"Key:",-1)),t("span",te,l(r.value.key||"(empty)"),1),e[6]||(e[6]=t("span",{class:"text-slate-500"},"TLS:",-1)),t("span",se,l(r.value.tls?"Yes (wss://)":"No (ws://)"),1),e[7]||(e[7]=t("span",{class:"text-slate-500"},"Protocol:",-1)),t("span",ae,l(r.value.tls?"wss":"ws")+"://"+l(r.value.host)+":"+l(r.value.port),1),e[8]||(e[8]=t("span",{class:"text-slate-500"},"Auth token:",-1)),t("span",ne,l(r.value.hasAuth?"Bearer token":r.value.hasGuest?"Guest token":"None"),1)])]),t("div",le,[m(b(h),{label:"Connect",severity:"success",size:"small",disabled:o.value==="connected",onClick:z},null,8,["disabled"]),m(b(h),{label:"Disconnect",severity:"danger",size:"small",disabled:o.value==="disconnected",onClick:A},null,8,["disabled"]),m(b(h),{label:"Clear log",severity:"secondary",size:"small",variant:"outlined",onClick:e[0]||(e[0]=a=>v.value=[])})]),t("div",oe,[e[11]||(e[11]=t("h2",{class:"text-sm font-semibold mb-3 text-slate-600 dark:text-slate-400 uppercase tracking-wide"},"Channel Test",-1)),t("div",re,[m(b(W),{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"Game code (e.g. ABCDEF)",class:"flex-1 font-mono uppercase",size:"small"},null,8,["modelValue"]),m(b(h),{label:d.value?"Leave":"Join",severity:d.value?"danger":"success",size:"small",disabled:o.value!=="connected"||!x.value&&!d.value,onClick:e[2]||(e[2]=a=>d.value?P():B())},null,8,["label","severity","disabled"])]),d.value?(c(),i("p",de,[e[10]||(e[10]=F(" Subscribed to: ",-1)),t("span",ie,"presence-game."+l(d.value),1)])):S("",!0),u.value.length>0?(c(),i("div",ce,[t("p",ue,"Members ("+l(u.value.length)+"):",1),t("div",ve,[(c(!0),i(E,null,N(u.value,a=>(c(),i("span",{key:a.id,class:"text-xs px-2 py-0.5 rounded bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300"},l(a.nickname||a.id),1))),128))])])):S("",!0)]),t("div",me,[t("h2",be," Event Log ("+l(v.value.length)+") ",1),v.value.length===0?(c(),i("div",pe," No events yet. Connect and join a game channel to see events. ")):(c(),i("div",ge,[(c(!0),i(E,null,N(v.value,(a,w)=>(c(),i("div",{key:w,class:k(["flex gap-2 p-2 rounded",{"bg-emerald-50 dark:bg-emerald-950/30":a.type==="success","bg-red-50 dark:bg-red-950/30":a.type==="error","bg-blue-50 dark:bg-blue-950/30":a.type==="event","bg-slate-100 dark:bg-slate-800":a.type==="info"}])},[t("span",xe,l(a.time),1),t("span",{class:k({"text-emerald-700 dark:text-emerald-300":a.type==="success","text-red-700 dark:text-red-300":a.type==="error","text-blue-700 dark:text-blue-300":a.type==="event","text-slate-700 dark:text-slate-300":a.type==="info"})},l(a.message),3)],2))),128))]))])]))}};export{he as default};
