const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/howler-XRTnVIhZ.js","assets/app-CCP2hVtR.js"])))=>i.map(i=>d[i]);
import{aa as z,m as r,ab as ke,n as V,ac as Ie,j as u,ad as U,ae as Ae}from"./app-CCP2hVtR.js";const $="select-sound-enabled",q="select-sound-volume",p=z("sound",()=>{const l=r(localStorage.getItem($)!=="false"),s=r(parseFloat(localStorage.getItem(q)||"0.3")),v={};function i(){l.value=!l.value,localStorage.setItem($,String(l.value))}function A(c){s.value=Math.max(0,Math.min(1,c)),localStorage.setItem(q,String(s.value)),Object.values(v).forEach(o=>{o&&o.volume(s.value)})}function g(c){return v[c]?v[c]:ke(async()=>{const{Howl:o}=await import("./howler-XRTnVIhZ.js").then(d=>d.h);return{Howl:o}},__vite__mapDeps([0,1])).then(({Howl:o})=>{const m={"round-start":"/sounds/round-start.mp3","time-warning":"/sounds/time-warning.mp3","time-up":"/sounds/time-up.mp3","vote-reveal":"/sounds/vote-reveal.mp3","game-win":"/sounds/game-win.mp3","player-join":"/sounds/player-join.mp3","chat-message":"/sounds/chat-message.mp3"}[c];if(!m)return null;const _=new o({src:[m],volume:s.value,preload:!1});return v[c]=_,_})}function y(c){if(!l.value)return;const o=v[c];if(o){o.volume(s.value),o.play();return}g(c).then(d=>{d&&(d.volume(s.value),d.play())})}return{enabled:l,volume:s,toggle:i,setVolume:A,play:y}}),je=z("game",()=>{const l=r(null),s=r([]),v=r(null),i=r(null),A=r(""),g=r([]),y=r(null),c=r(null),o=r([]),d=r(null),m=r(0),_=r([]),w=r(null),M=r(!1),h=r(0),b=r(0),S=r(null);let x=null;const J=V(()=>{if(!l.value)return!1;const a=E()?.player?.id;return a?l.value.host_player_id===a?!0:s.value.find(t=>t.id===a)?.is_co_host===!0:!1}),N=V(()=>{if(!l.value)return!1;const n=E();return l.value.host_player_id===n?.player?.id}),Q=V(()=>y.value!==null),X=V(()=>c.value!==null),Z=V(()=>l.value?.code??null);let T=null;function E(){if(!T)try{const n=Object.assign({"./authStore.js":Ie}),a=Object.keys(n)[0];T=n[a].useAuthStore()}catch{return null}return T}function R(){v.value=null,A.value="",g.value=[],y.value=null,c.value=null,o.value=[],w.value=null,h.value=0,b.value=0,M.value=!1,I(),P(),d.value=null,m.value=0}async function D(n){const{data:a}=await u.games.get(n);return l.value=a.game,s.value=a.game.players||[],O(a.game.status,a.round?.status),a}async function ee(n){R();const{data:a}=await u.games.create(n);return l.value=a.game,s.value=a.game.players||[],i.value="lobby",a}async function ae(n,a){R();const{data:e}=await u.games.join(n,a);return l.value=e.game,s.value=e.game.players||[],O(e.game.status,e.round?.status),e}async function ne(n){const{data:a}=await u.games.leave(n);return C(),a}async function te(n){R();const{data:a}=await u.games.start(n);return l.value=a.game,a.round&&j(a.round),i.value="playing",a}async function le(n,a){const{data:e}=await u.rounds.submitAnswer(n,a);return y.value=e.answer,e}async function se(n,a){const{data:e}=await u.rounds.submitVote(n,a);return c.value=e.vote,e}async function ue(n){await u.rounds.retractVote(n),c.value=null}async function ie(n,a){const{data:e}=await u.rounds.markReady(n,a);return h.value=e.ready_count,b.value=e.total_players,e}async function oe(n){const{data:a}=await u.games.end(n);return C(),a}async function re(n){await u.games.keepalive(n),M.value=!1}async function ce(n){const{data:a}=await u.games.addBot(n);return a.player&&!s.value.find(e=>e.id===a.player.id)&&s.value.push(a.player),a}async function ve(n,a){const{data:e}=await u.games.removeBot(n,a);return s.value=s.value.filter(t=>t.id!==e.player_id),e}async function de(n,a){const{data:e}=await u.games.kick(n,a);return s.value=s.value.filter(t=>t.id!==e.player_id),e}async function me(n,a,e){const{data:t}=await u.games.ban(n,a,e);return s.value=s.value.filter(f=>f.id!==t.player_id),t}async function fe(n,a){const{data:e}=await u.games.unban(n,a);if(l.value){const t=await u.games.get(n);l.value=t.data.game}return e}async function ye(n,a){const{data:e}=await u.games.toggleCoHost(n,a),t=s.value.find(f=>f.id===e.player_id);return t&&(t.is_co_host=e.is_co_host),e}async function ge(n,a){const{data:e}=await u.games.updateVisibility(n,a);return l.value&&(l.value.is_public=e.is_public),e}async function pe(n,a){const{data:e}=await u.games.updateSettings(n,a);return l.value&&(l.value.settings=e.settings,l.value.is_public=e.is_public),e}async function _e(n){const{data:a}=await u.games.rematch(n);return C(),l.value=a.game,s.value=a.game.players||[],i.value="lobby",a}async function we(n,a,e=!1){const{data:t}=await u.games.chat(n,a,e);t.message&&_.value.push({...t.message,action:e})}async function H(n){const{data:a}=await u.games.state(n);if(l.value=a.game,s.value=a.game.players||[],a.phase?i.value=a.phase:O(a.game.status,a.round?.status),a.round&&j(a.round),a.my_answer&&(y.value=a.my_answer),a.round?.ready_count!==void 0&&(h.value=a.round.ready_count,b.value=a.round.total_players),a.my_vote&&(c.value=a.my_vote),a.answers&&!g.value.length){const e=y.value?.id;g.value=F((a.answers||[]).map(t=>({...t,is_own:t.id===e||t.player_id===E()?.player?.id})))}if(a.completed_rounds&&(l.value.completed_rounds=a.completed_rounds),i.value==="results"&&a.completed_rounds?.length){const e=a.completed_rounds[a.completed_rounds.length-1];if(e?.answers&&!w.value&&(w.value=e.answers.map(t=>({text:t.text,player_nickname:t.player_name,votes_count:t.votes_count}))),o.value.length||(o.value=(a.game.players||[]).map(t=>({player_id:t.id,nickname:t.nickname,player_name:t.nickname,score:t.score??0})).sort((t,f)=>f.score-t.score)),!G){const t=a.game.settings?.time_between_rounds??15;W(t)}}return i.value==="finished"&&(a.game.winner!==void 0&&(l.value.winner=a.game.winner),o.value.length||(o.value=(a.game.players||[]).map(e=>({player_id:e.id,nickname:e.nickname,player_name:e.nickname,score:e.score??0})).sort((e,t)=>t.score-e.score))),a}async function he(n){try{const{data:a}=await u.games.currentRound(n);return a.round&&j(a.round),a}catch{return null}}function be(n){S.value&&U(S.value._code);const a=Ae(n);return a._code=n,S.value=a,a.here(e=>{}).joining(e=>{p().play("player-join")}).leaving(e=>{}).listen(".player.joined",e=>{e.player&&!s.value.find(t=>t.id===e.player.id)&&s.value.push(e.player),p().play("player-join")}).listen(".player.left",e=>{s.value=s.value.filter(t=>t.id!==e.player_id),e.new_host_id&&l.value&&(l.value.host_player_id=e.new_host_id)}).listen(".player.kicked",e=>{s.value=s.value.filter(f=>f.id!==e.player_id),E()?.player?.id===e.player_id&&(e.banned?(sessionStorage.setItem("select-kicked","banned"),e.ban_reason&&sessionStorage.setItem("select-banned-reason",e.ban_reason)):sessionStorage.setItem("select-kicked","kicked"),C(),window.location.href="/spill")}).listen(".game.started",e=>{R(),i.value="playing",l.value&&(l.value.status="playing"),e.round&&j(e.round)}).listen(".round.started",e=>{i.value="playing",y.value=null,c.value=null,g.value=[],w.value=null,h.value=0,b.value=0,j(e),p().play("round-start")}).listen(".answer.submitted",e=>{v.value&&(v.value.answers_count=e.answers_count,v.value.total_players=e.total_players)}).listen(".player.ready",e=>{h.value=e.ready_count,b.value=e.total_players}).listen(".voting.started",e=>{i.value="voting";const t=y.value?.id;g.value=F((e.answers||[]).map(Y=>({...Y,is_own:Y.id===t})));const f=e.vote_deadline||e.deadline;f&&(d.value=new Date(f),K())}).listen(".vote.submitted",e=>{v.value&&(v.value.votes_count=e.votes_count,v.value.total_voters=e.total_voters)}).listen(".round.completed",e=>{i.value="results",w.value=e.results||[],o.value=e.scores||[],I(),d.value=null,p().play("vote-reveal");const t=e.time_between_rounds??l.value?.settings?.time_between_rounds??15;W(t)}).listen(".game.finished",e=>{i.value="finished",o.value=e.final_scores||[],l.value&&(l.value.status="finished",l.value.winner=e.winner),I(),p().play("game-win")}).listen(".game.rematch",e=>{e.new_game_code&&(window.location.href=`/spill/${e.new_game_code}`)}).listen(".co_host.changed",e=>{const t=s.value.find(f=>f.id===e.player_id);t&&(t.is_co_host=e.is_co_host)}).listen(".game.settings_changed",e=>{l.value&&(e.settings&&(l.value.settings=e.settings),e.is_public!==void 0&&(l.value.is_public=e.is_public))}).listen(".lobby.expiring",e=>{M.value=!0}).listen(".chat.message",e=>{_.value.push(e),e.system!==!0&&p().play("chat-message")}),a}function B(){S.value&&(U(S.value._code),S.value=null)}function j(n){if(v.value={...n,id:n.id||n.round_id},A.value=n.acronym||"",n.status==="completed")return;let a;n.status==="voting"&&n.vote_deadline?a=n.vote_deadline:a=n.answer_deadline||n.deadline,a&&(d.value=new Date(a),K())}function F(n){const a=n.filter(t=>!t.is_own),e=n.filter(t=>t.is_own);return[...a,...e]}function O(n,a=null){n==="lobby"?i.value="lobby":n==="finished"?i.value="finished":(n==="playing"||n==="voting")&&(a==="voting"?i.value="voting":a==="completed"?i.value="results":a==="answering"?i.value="playing":i.value=n==="voting"?"voting":"playing")}function K(){P(),I(),L(),x=setInterval(()=>{L();const n=i.value==="playing"||i.value==="voting";n&&m.value<=10&&m.value>0&&p().play("time-warning"),m.value<=0&&(I(),n&&(p().play("time-up"),Se()))},1e3)}let k=null;function Se(){k&&clearTimeout(k);const n=l.value?.code;n&&(k=setTimeout(async()=>{try{await H(n)}catch{}},3e3))}function I(){x&&(clearInterval(x),x=null)}function L(){if(!d.value){m.value=0;return}const n=Math.max(0,Math.floor((d.value.getTime()-Date.now())/1e3));m.value=n}let G=null;function W(n){P(),I(),d.value=null,m.value=n,G=setInterval(()=>{m.value=Math.max(0,m.value-1),m.value<=0&&P()},1e3)}function P(){G&&(clearInterval(G),G=null)}function C(){B(),k&&(clearTimeout(k),k=null),R(),_.value=[],l.value=null,s.value=[],i.value=null}return{currentGame:l,players:s,currentRound:v,phase:i,acronym:A,answers:g,myAnswer:y,myVote:c,scores:o,deadline:d,timeRemaining:m,chatMessages:_,roundResults:w,lobbyExpiring:M,readyCount:h,totalPlayersForReady:b,isHost:J,isActualHost:N,hasSubmittedAnswer:Q,hasVoted:X,gameCode:Z,fetchGame:D,createGame:ee,joinGame:ae,leaveGame:ne,startGame:te,submitAnswer:le,submitVote:se,retractVote:ue,endGame:oe,keepalive:re,addBot:ce,removeBot:ve,kickPlayer:de,banPlayer:me,unbanPlayer:fe,toggleCoHost:ye,updateVisibility:ge,updateSettings:pe,rematch:_e,markReady:ie,sendChatMessage:we,fetchGameState:H,fetchCurrentRound:he,connectWebSocket:be,disconnectWebSocket:B,resetState:C}});export{je as u};
