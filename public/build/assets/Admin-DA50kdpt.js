import{o as K,c as v,a as i,t as m,u as e,b as l,w as t,s as S,l as I,d as D,e as h,f as u,g,h as x,F as N,r as R,i as O,j as y,k as Q,m as d,n as W}from"./app-CCP2hVtR.js";import{s as X}from"./index-CznJ1WnQ.js";import{s as A,a as o}from"./index-CCusksE9.js";import{s as L,a as Y}from"./index-pIabuVH2.js";import{s as Z}from"./index-UD0nC4Og.js";import"./index-CdoIoPxA.js";import"./index-Idha0_VY.js";import"./index-BxUleAd_.js";const ee={class:"max-w-6xl mx-auto px-4 py-8 sm:py-12"},ae={class:"text-3xl font-bold mb-6 text-slate-800 dark:text-slate-200"},le={class:"mb-4"},se={class:"flex gap-2"},te={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},ne={key:1,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},de={class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400"},ie={class:"text-xs text-slate-500 dark:text-slate-400 mt-1"},oe={class:"space-y-4"},re={class:"flex flex-col gap-2"},ue={class:"text-sm font-medium text-slate-700 dark:text-slate-300"},ce={class:"flex items-center gap-2"},me={class:"text-sm text-slate-700 dark:text-slate-300"},ve={class:"flex justify-end gap-2"},we={__name:"Admin",setup(fe){const{t:s}=Q(),k=d([]),w=d(!0),$=d(""),V=d([]),C=d(!0),B=d(!0),c=d({}),f=d(!1),b=d(null),p=d(""),_=d(!1),T=d(!1);let P=null;const G=W(()=>[{label:s("admin.players"),value:c.value.total_players??0},{label:s("admin.games"),value:c.value.total_games??0},{label:s("admin.activeToday"),value:c.value.active_today??0},{label:s("admin.gamesToday"),value:c.value.games_today??0},{label:s("admin.finished"),value:c.value.games_finished??0},{label:s("admin.answers"),value:c.value.total_answers??0},{label:s("admin.banned"),value:c.value.banned_players??0}]);function j(n){return n?new Date(n).toLocaleDateString():""}function z(){clearTimeout(P),P=setTimeout(U,300)}async function U(){w.value=!0;try{const{data:n}=await y.admin.players({search:$.value||void 0});k.value=n.players??n.data??[]}catch{k.value=[]}finally{w.value=!1}}async function E(){C.value=!0;try{const{data:n}=await y.admin.games();V.value=n.games??n.data??[]}catch{V.value=[]}finally{C.value=!1}}async function F(){B.value=!0;try{const{data:n}=await y.admin.stats();c.value=n}catch{c.value={}}finally{B.value=!1}}function H(n){b.value=n,p.value="",_.value=!1,f.value=!0}async function M(){if(b.value){T.value=!0;try{await y.admin.ban(b.value.id,p.value,_.value),b.value.is_banned=!0,f.value=!1}catch{}finally{T.value=!1}}}async function q(n){try{await y.admin.unban(n.id),n.is_banned=!1}catch{}}return K(()=>{Promise.all([U(),E(),F()])}),(n,r)=>(u(),v("div",ee,[i("h1",ae,m(e(s)("admin.title")),1),l(e(Y),null,{default:t(()=>[l(e(L),{header:e(s)("admin.players")},{default:t(()=>[i("div",le,[l(e(S),{modelValue:$.value,"onUpdate:modelValue":r[0]||(r[0]=a=>$.value=a),placeholder:e(s)("archive.filterByPlayer"),class:"w-full sm:w-80",onInput:z},null,8,["modelValue","placeholder"])]),l(e(A),{value:k.value,loading:w.value,stripedRows:"",paginator:"",rows:20,pt:{root:{class:"border border-slate-200 dark:border-slate-800 rounded-2xl overflow-hidden"}}},{default:t(()=>[l(e(o),{field:"nickname",header:"Nickname"},{body:t(({data:a})=>[l(e(I),{href:`/profil/${a.nickname}`,class:"font-medium text-emerald-600 dark:text-emerald-400 hover:underline"},{default:t(()=>[D(m(a.nickname),1)]),_:2},1032,["href"])]),_:1}),l(e(o),{field:"email",header:"Email",class:"hidden sm:table-cell"}),l(e(o),{field:"is_guest",header:"Type"},{body:t(({data:a})=>[l(e(h),{value:a.is_guest?"Guest":"User",severity:a.is_guest?"secondary":"success"},null,8,["value","severity"])]),_:1}),l(e(o),{field:"games_played",header:e(s)("leaderboard.gamesPlayed"),class:"hidden sm:table-cell"},null,8,["header"]),l(e(o),{field:"is_banned",header:"Status"},{body:t(({data:a})=>[a.is_banned?(u(),g(e(h),{key:0,value:"Banned",severity:"danger"})):(u(),g(e(h),{key:1,value:"Active",severity:"success"}))]),_:1}),l(e(o),{header:"Actions",style:{width:"10rem"}},{body:t(({data:a})=>[i("div",se,[a.is_banned?(u(),g(e(x),{key:0,label:e(s)("admin.unban"),severity:"success",size:"small",onClick:J=>q(a)},null,8,["label","onClick"])):(u(),g(e(x),{key:1,label:e(s)("admin.ban"),severity:"danger",size:"small",variant:"outlined",onClick:J=>H(a)},null,8,["label","onClick"]))])]),_:1})]),_:1},8,["value","loading"])]),_:1},8,["header"]),l(e(L),{header:e(s)("admin.games")},{default:t(()=>[l(e(A),{value:V.value,loading:C.value,stripedRows:"",paginator:"",rows:20,pt:{root:{class:"border border-slate-200 dark:border-slate-800 rounded-2xl overflow-hidden"}}},{default:t(()=>[l(e(o),{field:"code",header:"Code"},{body:t(({data:a})=>[l(e(I),{href:`/arkiv/${a.code}`,class:"font-mono font-bold text-emerald-600 dark:text-emerald-400 hover:underline tracking-widest"},{default:t(()=>[D(" #"+m(a.code),1)]),_:2},1032,["href"])]),_:1}),l(e(o),{field:"status",header:"Status"},{body:t(({data:a})=>[l(e(h),{value:a.status,severity:a.status==="finished"?"success":a.status==="playing"?"info":"secondary"},null,8,["value","severity"])]),_:1}),l(e(o),{field:"player_count",header:e(s)("games.players")},null,8,["header"]),l(e(o),{field:"host_nickname",header:"Host",class:"hidden sm:table-cell"}),l(e(o),{field:"created_at",header:"Created",class:"hidden sm:table-cell"},{body:t(({data:a})=>[D(m(j(a.created_at)),1)]),_:1})]),_:1},8,["value","loading"])]),_:1},8,["header"]),l(e(L),{header:e(s)("admin.stats")},{default:t(()=>[B.value?(u(),v("div",te,[(u(),v(N,null,R(7,a=>l(e(X),{key:a,height:"5rem"})),64))])):(u(),v("div",ne,[(u(!0),v(N,null,R(G.value,a=>(u(),v("div",{key:a.label,class:"p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 text-center"},[i("p",de,m(a.value),1),i("p",ie,m(a.label),1)]))),128))]))]),_:1},8,["header"])]),_:1}),l(e(O),{visible:f.value,"onUpdate:visible":r[4]||(r[4]=a=>f.value=a),header:`${e(s)("admin.ban")} ${b.value?.nickname}`,modal:"",style:{width:"25rem"}},{footer:t(()=>[i("div",ve,[l(e(x),{label:e(s)("common.cancel"),severity:"secondary",variant:"text",onClick:r[3]||(r[3]=a=>f.value=!1)},null,8,["label"]),l(e(x),{label:e(s)("admin.ban"),severity:"danger",loading:T.value,onClick:M},null,8,["label","loading"])])]),default:t(()=>[i("div",oe,[i("div",re,[i("label",ue,m(e(s)("admin.banReason")),1),l(e(S),{modelValue:p.value,"onUpdate:modelValue":r[1]||(r[1]=a=>p.value=a),class:"w-full"},null,8,["modelValue"])]),i("div",ce,[l(e(Z),{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=a=>_.value=a)},null,8,["modelValue"]),i("span",me,m(e(s)("admin.banIp")),1)])])]),_:1},8,["visible","header"])]))}};export{we as default};
