import{v as B,c as i,a as t,t as s,u as e,F as G,r as W,p as m,y as j,b as c,s as _,h as N,w as S,d as y,l as U,k as $,m as x,z as E,n as I,f as u,x as L}from"./app-CCP2hVtR.js";import{s as M}from"./index-B5S8LY6B.js";import"./index-CdoIoPxA.js";const T={class:"max-w-md mx-auto px-4 py-12 sm:py-20"},z={key:0,class:"mb-6 p-4 rounded-2xl bg-emerald-50 dark:bg-emerald-950/50 border border-emerald-200 dark:border-emerald-900 text-center"},D={class:"text-sm font-medium text-emerald-700 dark:text-emerald-300 mb-1"},q={class:"text-xl font-mono font-bold tracking-[0.3em] text-emerald-600 dark:text-emerald-400"},H={class:"text-sm text-emerald-600 dark:text-emerald-400 mt-1"},J={class:"flex flex-wrap justify-center gap-1.5 mt-2"},K={class:"p-6 rounded-2xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 mb-6"},Q={class:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-200"},X={key:0,class:"p-3 rounded-lg bg-red-50 dark:bg-red-950/50 border border-red-200 dark:border-red-900 text-sm text-red-700 dark:text-red-300"},Y={class:"flex flex-col gap-2"},Z={for:"guestNickname",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},ee={class:"flex items-center gap-4 mb-6"},te={class:"text-sm text-slate-400 dark:text-slate-500"},ae={class:"text-3xl font-bold text-center mb-8 text-slate-800 dark:text-slate-200"},se={key:0,class:"p-3 rounded-lg bg-red-50 dark:bg-red-950/50 border border-red-200 dark:border-red-900 text-sm text-red-700 dark:text-red-300"},le={class:"flex flex-col gap-2"},re={for:"email",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},oe={key:0,class:"text-red-500"},de={class:"flex flex-col gap-2"},ne={for:"password",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},ie={key:0,class:"text-red-500"},ue={key:1,class:"flex flex-col gap-2"},ce={for:"twoFactorCode",class:"text-sm font-medium text-slate-700 dark:text-slate-300"},me={class:"mt-6 text-center space-y-3"},xe={class:"text-sm text-slate-500 dark:text-slate-400"},he={__name:"Login",props:{gamePreview:{type:Object,default:null}},setup(g){const V=B(),{t:l}=$(),d=E({email:"",password:"",twoFactorCode:""}),b=x(!1),f=x(""),n=E({}),C=x(!1),p=x(""),v=x(!1),h=x("");function F(){return new URLSearchParams(window.location.search).get("redirect")||""}function P(){const r=F()||"/spill";return r.startsWith("/")&&!r.startsWith("//")&&!r.includes("://")?r:"/spill"}const O=I(()=>{const r=F();return r?`/registrer?redirect=${encodeURIComponent(r)}`:"/registrer"});async function A(){if(p.value.trim()){v.value=!0,h.value="";try{await V.createGuest(p.value.trim()),L.visit(P())}catch(r){const a=r.response?.data;h.value=a?.errors?.nickname?.[0]||a?.message||l("common.error")}finally{v.value=!1}}}async function R(){b.value=!0,f.value="",Object.keys(n).forEach(r=>delete n[r]);try{await V.login(d.email,d.password,d.twoFactorCode||void 0),L.visit(P())}catch(r){const a=r.response?.status,o=r.response?.data;a===422&&o?.errors?Object.assign(n,Object.fromEntries(Object.entries(o.errors).map(([k,w])=>[k,Array.isArray(w)?w[0]:w]))):a===423||o?.two_factor?(C.value=!0,f.value=""):f.value=o?.message||l("common.error")}finally{b.value=!1}}return(r,a)=>(u(),i("div",T,[g.gamePreview?(u(),i("div",z,[t("p",D,s(e(l)("auth.joiningGame")),1),t("p",q," #"+s(g.gamePreview.code),1),t("p",H,s(e(l)("auth.gameWithPlayers").replace("{count}",g.gamePreview.player_count)),1),t("div",J,[(u(!0),i(G,null,W(g.gamePreview.players,(o,k)=>(u(),i("span",{key:k,class:"text-xs px-2 py-0.5 rounded-full bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300"},s(o),1))),128))])])):m("",!0),t("div",K,[t("h2",Q,s(e(l)("auth.guest.title")),1),t("form",{onSubmit:j(A,["prevent"]),class:"space-y-4"},[h.value?(u(),i("div",X,s(h.value),1)):m("",!0),t("div",Y,[t("label",Z,s(e(l)("auth.guest.nickname")),1),c(e(_),{id:"guestNickname",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=o=>p.value=o),class:"w-full"},null,8,["modelValue"])]),c(e(N),{type:"submit",label:e(l)("auth.guest.submit"),severity:"success",loading:v.value,class:"w-full"},null,8,["label","loading"])],32)]),t("div",ee,[a[4]||(a[4]=t("div",{class:"flex-1 h-px bg-slate-200 dark:bg-slate-800"},null,-1)),t("span",te,s(e(l)("auth.or")),1),a[5]||(a[5]=t("div",{class:"flex-1 h-px bg-slate-200 dark:bg-slate-800"},null,-1))]),t("h1",ae,s(e(l)("auth.login.title")),1),t("form",{onSubmit:j(R,["prevent"]),class:"space-y-5"},[f.value?(u(),i("div",se,s(f.value),1)):m("",!0),t("div",le,[t("label",re,s(e(l)("auth.login.email")),1),c(e(_),{id:"email",modelValue:d.email,"onUpdate:modelValue":a[1]||(a[1]=o=>d.email=o),type:"email",autocomplete:"email",invalid:!!n.email,class:"w-full"},null,8,["modelValue","invalid"]),n.email?(u(),i("small",oe,s(n.email),1)):m("",!0)]),t("div",de,[t("label",ne,s(e(l)("auth.login.password")),1),c(e(M),{id:"password",modelValue:d.password,"onUpdate:modelValue":a[2]||(a[2]=o=>d.password=o),feedback:!1,toggleMask:"",invalid:!!n.password,inputClass:"w-full",class:"w-full"},null,8,["modelValue","invalid"]),n.password?(u(),i("small",ie,s(n.password),1)):m("",!0)]),C.value?(u(),i("div",ue,[t("label",ce,s(e(l)("auth.login.twoFactor")),1),c(e(_),{id:"twoFactorCode",modelValue:d.twoFactorCode,"onUpdate:modelValue":a[3]||(a[3]=o=>d.twoFactorCode=o),type:"text",inputmode:"numeric",maxlength:"6",placeholder:e(l)("auth.login.twoFactorCode"),class:"w-full text-center tracking-[0.3em] text-lg"},null,8,["modelValue","placeholder"])])):m("",!0),c(e(N),{type:"submit",label:e(l)("auth.login.submit"),severity:"success",loading:b.value,class:"w-full"},null,8,["label","loading"])],32),t("div",me,[c(e(U),{href:"/glemt-passord",class:"text-sm text-emerald-600 dark:text-emerald-400 hover:underline"},{default:S(()=>[y(s(e(l)("auth.login.forgotPassword")),1)]),_:1}),t("p",xe,[y(s(e(l)("auth.login.noAccount"))+" ",1),c(e(U),{href:O.value,class:"text-emerald-600 dark:text-emerald-400 font-medium hover:underline"},{default:S(()=>[y(s(e(l)("auth.login.register")),1)]),_:1},8,["href"])])])]))}};export{he as default};
